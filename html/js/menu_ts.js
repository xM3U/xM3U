class MainMenu{constructor(){this.DocumentID="main-menu";this.HTMLTag="LI";this.ImagePath="img/"}createIMG(c){var t=document.createElement("IMG");return t.setAttribute("src",this.ImagePath+c),t}createValue(c){var t=document.createElement("P");return t.innerHTML=c,t}}class MainMenuItem extends MainMenu{constructor(t,i,e,u){super();this.menuKey=t,this.value=i,this.imgSrc=e,this.headline=u}createItem(){var t=document.createElement("LI");t.setAttribute("onclick","javascript: openThisMenu(this)"),t.setAttribute("id",this.id);var i=this.createIMG(this.imgSrc),e=this.createValue(this.value);t.appendChild(i),t.appendChild(e);var u=document.getElementById(this.DocumentID);switch(u.appendChild(t),this.menuKey){case"playlist":this.tableHeader=["{{.playlist.table.playlist}}","{{.playlist.table.tuner}}","{{.playlist.table.lastUpdate}}","{{.playlist.table.availability}} %","{{.playlist.table.type}}","{{.playlist.table.streams}}","{{.playlist.table.groupTitle}} %","{{.playlist.table.tvgID}} %","{{.playlist.table.uniqueID}} %"];break;case"xmltv":this.tableHeader=["{{.xmltv.table.guide}}","{{.xmltv.table.lastUpdate}}","{{.xmltv.table.availability}} %","{{.xmltv.table.channels}}","{{.xmltv.table.programs}}"];break;case"filter":this.tableHeader=["{{.filter.table.name}}","{{.filter.table.type}}","{{.filter.table.filter}}"];break;case"users":this.tableHeader=["{{.users.table.username}}","{{.users.table.password}}","{{.users.table.web}}","{{.users.table.pms}}","{{.users.table.m3u}}","{{.users.table.xml}}","{{.users.table.api}}"];break;case"mapping":this.tableHeader=["BULK","{{.mapping.table.chNo}}","{{.mapping.table.logo}}","{{.mapping.table.channelName}}","{{.mapping.table.playlist}}","{{.mapping.table.groupTitle}}","{{.mapping.table.xmltvFile}}","{{.mapping.table.xmltvID}}"];break}}}class Content{constructor(){this.DocumentID="content";this.TableID="content_table";this.headerClass="content_table_header";this.interactionID="content-interaction"}createHeadline(c){var t=document.createElement("H3");return t.innerHTML=c,t}createHR(){var c=document.createElement("HR");return c}createInteraction(){var c=document.createElement("DIV");return c.setAttribute("id",this.interactionID),c}createDIV(){var c=document.createElement("DIV");return c.id=this.DivID,c}createTABLE(){var c=document.createElement("TABLE");return c.id=this.TableID,c}createTableRow(){var c=document.createElement("TR");return c.className=this.headerClass,c}createTableContent(c){var t=new Object,i=new Array;switch(c){case"playlist":var e=new Array("m3u","hdhr");e.forEach(s=>{t=SERVER.settings.files[s];var o=getObjKeys(t);o.forEach(n=>{var p=document.createElement("TR");p.id=n,p.setAttribute("onclick",'javascript: openPopUp("'+s+'", this)');var r=new Cell;r.child=!0,r.childType="P",r.value=t[n].name,p.appendChild(r.createCell());var r=new Cell;r.child=!0,r.childType="P",SERVER.settings.buffer!="-"?r.value=t[n].tuner:r.value="-",p.appendChild(r.createCell());var r=new Cell;r.child=!0,r.childType="P",r.value=t[n]["last.update"],p.appendChild(r.createCell());var r=new Cell;r.child=!0,r.childType="P",r.value=t[n]["provider.availability"],p.appendChild(r.createCell());var r=new Cell;r.child=!0,r.childType="P",r.value=t[n].type.toUpperCase(),p.appendChild(r.createCell());var r=new Cell;r.child=!0,r.childType="P",r.value=t[n].compatibility.streams,p.appendChild(r.createCell());var r=new Cell;r.child=!0,r.childType="P",r.value=t[n].compatibility["group.title"],p.appendChild(r.createCell());var r=new Cell;r.child=!0,r.childType="P",r.value=t[n].compatibility["tvg.id"],p.appendChild(r.createCell());var r=new Cell;r.child=!0,r.childType="P",r.value=t[n].compatibility["stream.id"],p.appendChild(r.createCell()),i.push(p)})});break;case"filter":delete SERVER.settings.filter[-1],t=SERVER.settings.filter;var u=getObjKeys(t);u.forEach(s=>{var o=document.createElement("TR");o.id=s,o.setAttribute("onclick",'javascript: openPopUp("'+t[s].type+'", this)');var n=new Cell;n.child=!0,n.childType="P",n.value=t[s].name,o.appendChild(n.createCell());var n=new Cell;switch(n.child=!0,n.childType="P",t[s].type){case"custom-filter":n.value="{{.filter.custom}}";break;case"group-title":n.value="{{.filter.group}}";break;default:break}o.appendChild(n.createCell());var n=new Cell;n.child=!0,n.childType="P",n.value=t[s].filter,o.appendChild(n.createCell()),i.push(o)});break;case"xmltv":var e=new Array("xmltv");e.forEach(s=>{t=SERVER.settings.files[s];var o=getObjKeys(t);o.forEach(n=>{var p=document.createElement("TR");p.id=n,p.setAttribute("onclick",'javascript: openPopUp("'+s+'", this)');var r=new Cell;r.child=!0,r.childType="P",r.value=t[n].name,p.appendChild(r.createCell());var r=new Cell;r.child=!0,r.childType="P",r.value=t[n]["last.update"],p.appendChild(r.createCell());var r=new Cell;r.child=!0,r.childType="P",r.value=t[n]["provider.availability"],p.appendChild(r.createCell());var r=new Cell;r.child=!0,r.childType="P",r.value=t[n].compatibility["xmltv.channels"],p.appendChild(r.createCell());var r=new Cell;r.child=!0,r.childType="P",r.value=t[n].compatibility["xmltv.programs"],p.appendChild(r.createCell()),i.push(p)})});break;case"users":var e=new Array("users");e.forEach(s=>{t=SERVER[s];var o=getObjKeys(t);o.forEach(n=>{var p=document.createElement("TR");p.id=n,p.setAttribute("onclick",'javascript: openPopUp("'+s+'", this)');var r=new Cell;r.child=!0,r.childType="P",r.value=t[n].data.username,p.appendChild(r.createCell());var r=new Cell;r.child=!0,r.childType="P",r.value="******",p.appendChild(r.createCell());var r=new Cell;r.child=!0,r.childType="P",t[n].data["authentication.web"]==!0?r.value="\u2713":r.value="-",p.appendChild(r.createCell());var r=new Cell;r.child=!0,r.childType="P",t[n].data["authentication.pms"]==!0?r.value="\u2713":r.value="-",p.appendChild(r.createCell());var r=new Cell;r.child=!0,r.childType="P",t[n].data["authentication.m3u"]==!0?r.value="\u2713":r.value="-",p.appendChild(r.createCell());var r=new Cell;r.child=!0,r.childType="P",t[n].data["authentication.xml"]==!0?r.value="\u2713":r.value="-",p.appendChild(r.createCell());var r=new Cell;r.child=!0,r.childType="P",t[n].data["authentication.api"]==!0?r.value="\u2713":r.value="-",p.appendChild(r.createCell()),i.push(p)})});break;case"mapping":BULK_EDIT=!1,createSearchObj(),checkUndo("epgMapping"),t=SERVER.xepg.epgMapping;var u=getObjKeys(t);u.forEach(s=>{var o=document.createElement("TR");switch(o.id=s,t[s]["x-active"]){case!0:o.className="activeEPG";break;case!1:o.className="notActiveEPG";break}var n=new Cell;n.child=!0,n.childType="BULK",n.value=!1,o.appendChild(n.createCell());var n=new Cell;n.child=!0,n.childType="INPUTCHANNEL",n.value=t[s]["x-channelID"],o.appendChild(n.createCell());var n=new Cell;n.child=!0,n.childType="IMG",n.imageURL=t[s]["tvg-logo"];var r=n.createCell();r.setAttribute("onclick",'javascript: openPopUp("mapping", this)'),r.id=s,o.appendChild(r);var n=new Cell;n.child=!0,n.childType="P",n.className=t[s]["x-category"],n.value=t[s]["x-name"];var r=n.createCell();r.setAttribute("onclick",'javascript: openPopUp("mapping", this)'),r.id=s,o.appendChild(r);var n=new Cell;n.child=!0,n.childType="P",n.value=getValueFromProviderFile(t[s]["_file.m3u.id"],"m3u","name");var r=n.createCell();r.setAttribute("onclick",'javascript: openPopUp("mapping", this)'),r.id=s,o.appendChild(r);var n=new Cell;n.child=!0,n.childType="P",n.value=t[s]["x-group-title"];var r=n.createCell();r.setAttribute("onclick",'javascript: openPopUp("mapping", this)'),r.id=s,o.appendChild(r);var n=new Cell;n.child=!0,n.childType="P",t[s]["x-xmltv-file"]!="-"?n.value=getValueFromProviderFile(t[s]["x-xmltv-file"],"xmltv","name"):n.value=t[s]["x-xmltv-file"];var r=n.createCell();r.setAttribute("onclick",'javascript: openPopUp("mapping", this)'),r.id=s,o.appendChild(r);var n=new Cell;n.child=!0,n.childType="P";var p=t[s]["x-mapping"];p.length>20&&(p=t[s]["x-mapping"].substring(0,20)+"..."),n.value=p;var r=n.createCell();r.setAttribute("onclick",'javascript: openPopUp("mapping", this)'),r.id=s,o.appendChild(r),i.push(o)});break;case"settings":alert();break;default:break}return i}}class Cell{createCell(){var c=document.createElement("TD");if(this.child==!0){var t;switch(this.childType){case"P":t=document.createElement(this.childType),t.innerHTML=this.value,t.className=this.className;break;case"INPUT":t=document.createElement(this.childType),t.value=this.value,t.type="text";break;case"INPUTCHANNEL":t=document.createElement("INPUT"),t.setAttribute("onchange","javscript: changeChannelNumber(this)"),t.value=this.value,t.type="text";break;case"BULK":t=document.createElement("INPUT"),t.checked=this.value,t.type="checkbox",t.className="bulk hideBulk";break;case"BULK_HEAD":t=document.createElement("INPUT"),t.checked=this.value,t.type="checkbox",t.className="bulk hideBulk",t.setAttribute("onclick","javascript: selectAllChannels()");break;case"IMG":t=document.createElement(this.childType),t.setAttribute("src",this.imageURL),this.imageURL!=""&&t.setAttribute("onerror","javascript: this.onerror=null;this.src=''")}c.appendChild(t)}else c.innerHTML=this.value;return this.onclick==!0&&(c.setAttribute("onclick",this.onclickFunktion),c.className="pointer"),this.tdClassName!=null&&(c.className=this.tdClassName),c}}class ShowContent extends Content{constructor(t){super();this.menuID=t}createInput(t,i,e){var u=document.createElement("INPUT");return u.setAttribute("type",t),u.setAttribute("name",i),u.setAttribute("value",e),u}show(){COLUMN_TO_SORT=-1;var t=document.getElementById(this.DocumentID);t.innerHTML="",showPreview(!1);var i=menuItems[this.menuID].headline,e=menuItems[this.menuID].menuKey,u=this.createHeadline(i);t.appendChild(u);var s=this.createHR();t.appendChild(s);var o=this.createInteraction();t.appendChild(o);var n=document.getElementById(this.interactionID);switch(e){case"playlist":var r=this.createInput("button",e,"{{.button.new}}");r.setAttribute("id","-"),r.setAttribute("onclick",'javascript: openPopUp("playlist")'),n.appendChild(r);break;case"filter":var r=this.createInput("button",e,"{{.button.new}}");r.setAttribute("id",-1),r.setAttribute("onclick",'javascript: openPopUp("filter", this)'),n.appendChild(r);break;case"xmltv":var r=this.createInput("button",e,"{{.button.new}}");r.setAttribute("id","xmltv"),r.setAttribute("onclick",'javascript: openPopUp("xmltv")'),n.appendChild(r);break;case"users":var r=this.createInput("button",e,"{{.button.new}}");r.setAttribute("id","users"),r.setAttribute("onclick",'javascript: openPopUp("users")'),n.appendChild(r);break;case"mapping":showElement("loading",!0);var r=this.createInput("button",e,"{{.button.save}}");r.setAttribute("onclick",'javascript: savePopupData("mapping", "", "")'),n.appendChild(r);var r=this.createInput("button",e,"{{.button.bulkEdit}}");r.setAttribute("onclick","javascript: bulkEdit()"),n.appendChild(r);var r=this.createInput("search","search","");r.setAttribute("id","searchMapping"),r.setAttribute("placeholder","{{.button.search}}"),r.className="search",r.setAttribute("onchange","javascript: searchInMapping()"),n.appendChild(r);break;case"settings":var r=this.createInput("button",e,"{{.button.save}}");r.setAttribute("onclick","javascript: saveSettings();"),n.appendChild(r);var r=this.createInput("button",e,"{{.button.backup}}");r.setAttribute("onclick","javascript: backup();"),n.appendChild(r);var r=this.createInput("button",e,"{{.button.restore}}");r.setAttribute("onclick","javascript: restore();"),n.appendChild(r);var h=document.createElement("DIV");h.setAttribute("id","box-wrapper"),t.appendChild(h),this.DivID="content_settings";var p=this.createDIV();h.appendChild(p),showSettings();return;case"log":var r=this.createInput("button",e,"{{.button.resetLogs}}");r.setAttribute("onclick","javascript: resetLogs();"),n.appendChild(r);var h=document.createElement("DIV");h.setAttribute("id","box-wrapper"),t.appendChild(h),this.DivID="content_log";var l=this.createDIV();h.appendChild(l),showLogs(!0);return;case"logout":location.reload(),document.cookie="Token= ; expires = Thu, 01 Jan 1970 00:00:00 GMT";break;default:break}var b=menuItems[this.menuID].tableHeader;if(b.length>0){var h=document.createElement("DIV");t.appendChild(h),h.setAttribute("id","box-wrapper");var v=this.createTABLE();h.appendChild(v);var m=this.createTableRow();v.appendChild(m),b.forEach(f=>{var g=new Cell;g.child=!0,g.childType="P",g.value=f,f=="BULK"&&(g.childType="BULK_HEAD",g.value=!1),e=="mapping"&&(f=="{{.mapping.table.chNo}}"&&(g.onclick=!0,g.onclickFunktion="javascript: sortTable(1);",g.tdClassName="sortThis"),f=="{{.mapping.table.channelName}}"&&(g.onclick=!0,g.onclickFunktion="javascript: sortTable(3);"),f=="{{.mapping.table.playlist}}"&&(g.onclick=!0,g.onclickFunktion="javascript: sortTable(4);"),f=="{{.mapping.table.groupTitle}}"&&(g.onclick=!0,g.onclickFunktion="javascript: sortTable(5);")),m.appendChild(g.createCell())}),v.appendChild(m);var a=this.createTableContent(e);a.forEach(f=>{v.appendChild(f)})}switch(e){case"mapping":sortTable(1);break;case"filter":showPreview(!0),sortTable(0);break;default:COLUMN_TO_SORT=-1,sortTable(0);break}showElement("loading",!1)}}function PageReady(){var d=new Server("getServerConfig");d.request(new Object),window.addEventListener("resize",function(){calculateWrapperHeight()},!0),setInterval(function(){updateLog()},1e4)}function createLayout(){for(var d=SERVER.clientInfo,c=getObjKeys(d),t=0;t<c.length;t++)document.getElementById(c[t])&&(document.getElementById(c[t]).innerHTML=d[c[t]]);if(!!document.getElementById("main-menu")){document.getElementById("main-menu").innerHTML="";for(let i=0;i<menuItems.length;i++)switch(menuItems[i].id=i,menuItems[i].menuKey){case"users":case"logout":SERVER.settings["authentication.web"]==!0&&menuItems[i].createItem();break;case"mapping":case"xmltv":SERVER.clientInfo.epgSource=="XEPG"&&menuItems[i].createItem();break;default:menuItems[i].createItem();break}}}function openThisMenu(d){var c=d.id,t=new ShowContent(c);t.show(),calculateWrapperHeight()}class PopupWindow{constructor(){this.DocumentID="popup-custom";this.InteractionID="interaction";this.doc=document.getElementById(this.DocumentID)}createTitle(c){var t=document.createElement("TD");return t.className="left",t.innerHTML=c+":",t}createContent(c){var t=document.createElement("TD");return t.appendChild(c),t}createInteraction(){var c=document.createElement("div");c.setAttribute("id","popup-interaction"),c.className="interaction",this.doc.appendChild(c)}}class PopupContent extends PopupWindow{constructor(){super(...arguments);this.table=document.createElement("TABLE")}createHeadline(t){this.doc.innerHTML="";var i=document.createElement("H3");i.innerHTML=t.toUpperCase(),this.doc.appendChild(i),this.table=document.createElement("TABLE"),this.doc.appendChild(this.table)}appendRow(t,i){var e=document.createElement("TR");t.length!=0&&e.appendChild(this.createTitle(t)),e.appendChild(this.createContent(i)),this.table.appendChild(e)}createInput(t,i,e){var u=document.createElement("INPUT");return e==null&&(e=""),u.setAttribute("type",t),u.setAttribute("name",i),u.setAttribute("value",e),u}createCheckbox(t){var i=document.createElement("INPUT");return i.setAttribute("type","checkbox"),i.setAttribute("name",t),i}createSelect(t,i,e,u){var s=document.createElement("SELECT");s.setAttribute("name",u);for(let n=0;n<t.length;n++){var o=document.createElement("OPTION");o.setAttribute("value",i[n]),o.innerText=t[n],s.appendChild(o)}return e!=""&&(s.value=e),e==null&&(s.value=i[0]),s}selectOption(t,i){var e=t;return e.options[e.selectedIndex].value=i,t}description(t){var i=document.createElement("TR"),e=document.createElement("TD"),u=document.createElement("PRE");u.innerHTML=t,i.appendChild(e),i.appendChild(this.createContent(u)),this.table.appendChild(i)}addInteraction(t){var i=document.getElementById("popup-interaction");i.appendChild(t)}}function openPopUp(d,c){var t=new Object,i;switch(c){case void 0:switch(d){case"group-title":i==null&&(i=-1),t=getLocalData("filter",i),t.type="group-title";break;case"custom-filter":i==null&&(i=-1),t=getLocalData("filter",i),t.type="custom-filter";break;default:t["id.provider"]="-",t.type=d,i="-";break}break;default:i=c.id,t=getLocalData(d,i);break}var e=new PopupContent;switch(d){case"playlist":e.createHeadline("{{.playlist.playlistType.title}}");var n=["M3U","HDHomeRun"],p=["javascript: openPopUp('m3u')","javascript: openPopUp('hdhr')"],v=e.createSelect(n,p,"","type");v.setAttribute("id","type"),v.setAttribute("onchange",'javascript: changeButtonAction(this, "next", "onclick")'),e.appendRow("{{.playlist.type.title}}",v),e.createInteraction();var a=e.createInput("button","cancel","{{.button.cancel}}");a.setAttribute("onclick",'javascript: showElement("popup", false);'),e.addInteraction(a);var a=e.createInput("button","next","{{.button.next}}");a.setAttribute("onclick",'javascript: openPopUp("m3u")'),a.setAttribute("id","next"),e.addInteraction(a);break;case"m3u":e.createHeadline(d);var l="name",a=e.createInput("text",l,t[l]);a.setAttribute("placeholder","{{.playlist.name.placeholder}}"),e.appendRow("{{.playlist.name.title}}",a);var l="description",a=e.createInput("text",l,t[l]);a.setAttribute("placeholder","{{.playlist.description.placeholder}}"),e.appendRow("{{.playlist.description.title}}",a);var l="file.source",a=e.createInput("text",l,t[l]);if(a.setAttribute("placeholder","{{.playlist.fileM3U.placeholder}}"),e.appendRow("{{.playlist.fileM3U.title}}",a),SERVER.settings.buffer!="-"){for(var n=new Array,p=new Array,u=1;u<=100;u++)n.push(u.toString()),p.push(u.toString());var l="tuner",v=e.createSelect(n,p,t[l],l);v.setAttribute("onfocus","javascript: return;"),e.appendRow("{{.playlist.tuner.title}}",v)}else{var l="tuner";t[l]==null&&(t[l]=1);var a=e.createInput("text",l,t[l]);a.setAttribute("readonly","true"),a.className="notAvailable",e.appendRow("{{.playlist.tuner.title}}",a)}if(e.description("{{.playlist.tuner.description}}"),e.createInteraction(),t["id.provider"]!="-"){var a=e.createInput("button","delete","{{.button.delete}}");a.className="delete",a.setAttribute("onclick",'javascript: savePopupData("m3u", "'+i+'", true, 0)'),e.addInteraction(a)}else{var a=e.createInput("button","back","{{.button.back}}");a.setAttribute("onclick",'javascript: openPopUp("playlist")'),e.addInteraction(a)}var a=e.createInput("button","cancel","{{.button.cancel}}");if(a.setAttribute("onclick",'javascript: showElement("popup", false);'),e.addInteraction(a),t["id.provider"]!="-"){var a=e.createInput("button","update","{{.button.update}}");a.setAttribute("onclick",'javascript: savePopupData("m3u", "'+i+'", false, 1)'),e.addInteraction(a)}var a=e.createInput("button","save","{{.button.save}}");a.setAttribute("onclick",'javascript: savePopupData("m3u", "'+i+'", false, 0)'),e.addInteraction(a);break;case"hdhr":e.createHeadline(d);var l="name",a=e.createInput("text",l,t[l]);a.setAttribute("placeholder","{{.playlist.name.placeholder}}"),e.appendRow("{{.playlist.name.title}}",a);var l="description",a=e.createInput("text",l,t[l]);a.setAttribute("placeholder","{{.playlist.description.placeholder}}"),e.appendRow("{{.playlist.description.placeholder}}",a);var l="file.source",a=e.createInput("text",l,t[l]);if(a.setAttribute("placeholder","{{.playlist.fileHDHR.placeholder}}"),e.appendRow("{{.playlist.fileHDHR.title}}",a),SERVER.settings.buffer!="-"){for(var n=new Array,p=new Array,u=1;u<=100;u++)n.push(u.toString()),p.push(u.toString());var l="tuner",v=e.createSelect(n,p,t[l],l);v.setAttribute("onfocus","javascript: return;"),e.appendRow("{{.playlist.tuner.title}}",v)}else{var l="tuner";t[l]==null&&(t[l]=1);var a=e.createInput("text",l,t[l]);a.setAttribute("readonly","true"),a.className="notAvailable",e.appendRow("{{.playlist.tuner.title}}",a)}if(e.description("{{.playlist.tuner.description}}"),e.createInteraction(),t["id.provider"]!="-"){var a=e.createInput("button","delete","{{.button.delete}}");a.setAttribute("onclick",'javascript: savePopupData("hdhr", "'+i+'", true, 0)'),a.className="delete",e.addInteraction(a)}else{var a=e.createInput("button","back","{{.button.back}}");a.setAttribute("onclick",'javascript: openPopUp("playlist")'),e.addInteraction(a)}var a=e.createInput("button","cancel","{{.button.cancel}}");if(a.setAttribute("onclick",'javascript: showElement("popup", false);'),e.addInteraction(a),t["id.provider"]!="-"){var a=e.createInput("button","update","{{.button.update}}");a.setAttribute("onclick",'javascript: savePopupData("hdhr", "'+i+'", false, 1)'),e.addInteraction(a)}var a=e.createInput("button","save","{{.button.save}}");a.setAttribute("onclick",'javascript: savePopupData("hdhr", "'+i+'", false, 0)'),e.addInteraction(a);break;case"filter":e.createHeadline(d);var l="type",n=["M3U: {{.filter.type.groupTitle}}","xTeVe: {{.filter.type.customFilter}}"],p=["javascript: openPopUp('group-title')","javascript: openPopUp('custom-filter')"],v=e.createSelect(n,p,"javascript: openPopUp('group-title')",l);v.setAttribute("id",i),v.setAttribute("onchange",'javascript: changeButtonAction(this, "next", "onclick");'),e.appendRow("{{.filter.type.title}}",v),e.createInteraction();var a=e.createInput("button","cancel","{{.button.cancel}}");a.setAttribute("onclick",'javascript: showElement("popup", false);'),e.addInteraction(a);var a=e.createInput("button","next","{{.button.next}}");a.setAttribute("onclick",'javascript: openPopUp("group-title")'),a.setAttribute("id","next"),e.addInteraction(a);break;case"custom-filter":case"group-title":switch(d){case"custom-filter":e.createHeadline("{{.filter.custom}}");break;case"group-title":e.createHeadline("{{.filter.group}}");break}var l="name",a=e.createInput("text",l,t[l]);a.setAttribute("placeholder","{{.filter.name.placeholder}}"),e.appendRow("{{.filter.name.title}}",a);var l="description",a=e.createInput("text",l,t[l]);a.setAttribute("placeholder","{{.filter.description.placeholder}}"),e.appendRow("{{.filter.description.title}}",a);var l="type",a=e.createInput("hidden",l,t[l]);e.appendRow("",a);var s=t[l];switch(s){case"custom-filter":var l="caseSensitive",a=e.createCheckbox(l);a.checked=t[l],e.appendRow("{{.filter.caseSensitive.title}}",a);var l="filter",a=e.createInput("text",l,t[l]);a.setAttribute("placeholder","{{.filter.filterRule.placeholder}}"),e.appendRow("{{.filter.filterRule.title}}",a);break;case"group-title":var l="filter",o=getLocalData("m3uGroups",""),n=o.text,p=o.value,v=e.createSelect(n,p,t[l],l);v.setAttribute("onchange","javascript: this.className = 'changed'"),e.appendRow("{{.filter.filterGroup.title}}",v),e.description("{{.filter.filterGroup.description}}");var l="caseSensitive",a=e.createCheckbox(l);a.checked=t[l],e.appendRow("{{.filter.caseSensitive.title}}",a);var l="include",a=e.createInput("text",l,t[l]);a.setAttribute("placeholder","{{.filter.include.placeholder}}"),e.appendRow("{{.filter.include.title}}",a),e.description("{{.filter.include.description}}");var l="exclude",a=e.createInput("text",l,t[l]);a.setAttribute("placeholder","{{.filter.exclude.placeholder}}"),e.appendRow("{{.filter.exclude.title}}",a),e.description("{{.filter.exclude.description}}");break;default:break}e.createInteraction();var a=e.createInput("button","delete","{{.button.delete}}");a.setAttribute("onclick",'javascript: savePopupData("filter", "'+i+'", true, 0)'),a.className="delete",e.addInteraction(a);var a=e.createInput("button","cancel","{{.button.cancel}}");a.setAttribute("onclick",'javascript: showElement("popup", false);'),e.addInteraction(a);var a=e.createInput("button","save","{{.button.save}}");a.setAttribute("onclick",'javascript: savePopupData("filter", "'+i+'", false, 0)'),e.addInteraction(a);break;case"xmltv":e.createHeadline(d);var l="name",a=e.createInput("text",l,t[l]);a.setAttribute("placeholder","{{.xmltv.name.placeholder}}"),e.appendRow("{{.xmltv.name.title}}",a);var l="description",a=e.createInput("text",l,t[l]);a.setAttribute("placeholder","{{.xmltv.description.placeholder}}"),e.appendRow("{{.xmltv.description.title}}",a);var l="file.source",a=e.createInput("text",l,t[l]);if(a.setAttribute("placeholder","{{.xmltv.fileXMLTV.placeholder}}"),e.appendRow("{{.xmltv.fileXMLTV.title}}",a),e.createInteraction(),t["id.provider"]!="-"){var a=e.createInput("button","delete","{{.button.delete}}");a.setAttribute("onclick",'javascript: savePopupData("xmltv", "'+i+'", true, 0)'),a.className="delete",e.addInteraction(a)}var a=e.createInput("button","cancel","{{.button.cancel}}");if(a.setAttribute("onclick",'javascript: showElement("popup", false);'),e.addInteraction(a),t["id.provider"]!="-"){var a=e.createInput("button","update","{{.button.update}}");a.setAttribute("onclick",'javascript: savePopupData("xmltv", "'+i+'", false, 1)'),e.addInteraction(a)}var a=e.createInput("button","save","{{.button.save}}");a.setAttribute("onclick",'javascript: savePopupData("xmltv", "'+i+'", false, 0)'),e.addInteraction(a);break;case"users":e.createHeadline("{{.mainMenu.item.users}}");var l="username",a=e.createInput("text",l,t[l]);a.setAttribute("placeholder","{{.users.username.placeholder}}"),e.appendRow("{{.users.username.title}}",a);var l="password",a=e.createInput("password",l,"");a.setAttribute("placeholder","{{.users.password.placeholder}}"),e.appendRow("{{.users.password.title}}",a);var l="confirm",a=e.createInput("password",l,"");a.setAttribute("placeholder","{{.users.confirm.placeholder}}"),e.appendRow("{{.users.confirm.title}}",a);var l="authentication.web",a=e.createCheckbox(l);a.checked=t[l],t.defaultUser==!0&&a.setAttribute("onclick","javascript: return false"),e.appendRow("{{.users.web.title}}",a);var l="authentication.pms",a=e.createCheckbox(l);a.checked=t[l],e.appendRow("{{.users.pms.title}}",a);var l="authentication.m3u",a=e.createCheckbox(l);a.checked=t[l],e.appendRow("{{.users.m3u.title}}",a);var l="authentication.xml",a=e.createCheckbox(l);a.checked=t[l],e.appendRow("{{.users.xml.title}}",a);var l="authentication.api",a=e.createCheckbox(l);if(a.checked=t[l],e.appendRow("{{.users.api.title}}",a),e.createInteraction(),t.defaultUser!=!0&&i!="-"){var a=e.createInput("button","delete","{{.button.delete}}");a.className="delete",a.setAttribute("onclick",'javascript: savePopupData("'+d+'", "'+i+'", true, 0)'),e.addInteraction(a)}var a=e.createInput("button","cancel","{{.button.cancel}}");a.setAttribute("onclick",'javascript: showElement("popup", false);'),e.addInteraction(a);var a=e.createInput("button","save","{{.button.save}}");a.setAttribute("onclick",'javascript: savePopupData("'+d+'", "'+i+'", "false");'),e.addInteraction(a);break;case"mapping":e.createHeadline("{{.mainMenu.item.mapping}}");var l="x-active",a=e.createCheckbox(l);a.checked=t[l],a.id="active",a.setAttribute("onchange","javascript: toggleChannelStatus('"+i+"', this)"),e.appendRow("{{.mapping.active.title}}",a);var l="x-name",a=e.createInput("text",l,t[l]);a.setAttribute("onchange","javascript: this.className = 'changed'"),BULK_EDIT==!0&&(a.style.border="solid 1px red",a.setAttribute("readonly","true")),e.appendRow("{{.mapping.channelName.title}}",a),e.description(t.name);var l="x-description",a=e.createInput("text",l,t[l]);if(a.setAttribute("placeholder","{{.mapping.description.placeholder}}"),a.setAttribute("onchange","javascript: this.className = 'changed'"),e.appendRow("{{.mapping.description.title}}",a),t.hasOwnProperty("_uuid.key")&&t["_uuid.key"]!=""){var l="x-update-channel-name",a=e.createCheckbox(l);a.setAttribute("onchange","javascript: this.className = 'changed'"),a.checked=t[l],e.appendRow("{{.mapping.updateChannelName.title}}",a)}var l="tvg-logo",a=e.createInput("text",l,t[l]);a.setAttribute("onchange","javascript: this.className = 'changed'"),a.setAttribute("id","channel-icon"),e.appendRow("{{.mapping.channelLogo.title}}",a);var l="x-update-channel-icon",a=e.createCheckbox(l);a.checked=t[l],a.setAttribute("id","update-icon"),a.setAttribute("onchange","javascript: this.className = 'changed'; changeChannelLogo('"+i+"');"),e.appendRow("{{.mapping.updateChannelLogo.title}}",a);var l="x-category",n=["-","Kids (Emby only)","News","Movie","Series","Sports"],p=["","Kids","News","Movie","Series","Sports"],v=e.createSelect(n,p,t[l],l);v.setAttribute("onchange","javascript: this.className = 'changed'"),e.appendRow("{{.mapping.epgCategory.title}}",v);var l="x-group-title",a=e.createInput("text",l,t[l]);a.setAttribute("onchange","javascript: this.className = 'changed'"),e.appendRow("{{.mapping.m3uGroupTitle.title}}",a),t["group-title"]!=null&&e.description(t["group-title"]);var l="x-xmltv-file",r=t[l],b=new XMLTVFile,v=b.getFiles(t[l]);v.setAttribute("name",l),v.setAttribute("id","popup-xmltv"),v.setAttribute("onchange","javascript: this.className = 'changed'; setXmltvChannel('"+i+"',this);"),e.appendRow("{{.mapping.xmltvFile.title}}",v);var h=t[l],l="x-mapping",b=new XMLTVFile,v=b.getPrograms(h,t[l]);v.setAttribute("name",l),v.setAttribute("id","popup-mapping"),v.setAttribute("onchange","javascript: this.className = 'changed'; checkXmltvChannel('"+i+"',this,'"+r+"');"),sortSelect(v),e.appendRow("{{.mapping.xmltvChannel.title}}",v),e.createInteraction();var a=e.createInput("button","cancel","{{.button.uploadLogo}}");a.setAttribute("onclick","javascript: uploadLogo();"),e.addInteraction(a);var a=e.createInput("button","cancel","{{.button.cancel}}");a.setAttribute("onclick",'javascript: showElement("popup", false);'),e.addInteraction(a);var m=new Array;m=getAllSelectedChannels(),m.length==0&&m.push(i);var a=e.createInput("button","save","{{.button.done}}");a.setAttribute("onclick",'javascript: donePopupData("'+d+'", "'+m+'", "false");'),e.addInteraction(a);break;default:break}showPopUpElement("popup-custom")}class XMLTVFile{getFiles(c){var t=getObjKeys(SERVER.xepg.xmltvMap),i=new Array("-"),e=new Array("-");for(let o=0;o<t.length;o++)t[o]!="xTeVe Dummy"?(i.push(getValueFromProviderFile(t[o],"xmltv","file.xteve")),e.push(getValueFromProviderFile(t[o],"xmltv","name"))):(i.push(t[o]),e.push(t[o]));var u=document.createElement("SELECT");for(let o=0;o<e.length;o++){var s=document.createElement("OPTION");s.setAttribute("value",i[o]),s.innerText=e[o],u.appendChild(s)}return c!=""&&(u.value=c),u}getPrograms(c,t){var i=getObjKeys(SERVER.xepg.xmltvMap[c]),e=new Array,u;for(let n=0;n<i.length;n++)SERVER.xepg.xmltvMap[c][i[n]].hasOwnProperty("display-name")==!0?u=SERVER.xepg.xmltvMap[c][i[n]]["display-name"]:u="-",e[n]=u+" ("+i[n]+")";e.unshift("-"),i.unshift("-");var s=document.createElement("SELECT");for(let n=0;n<e.length;n++){var o=document.createElement("OPTION");o.setAttribute("value",i[n]),o.innerText=e[n],s.appendChild(o)}return t!=""&&(s.value=t),s.value!=t&&(s.value="-"),s}}function getValueFromProviderFile(d,c,t){if(d=="xTeVe Dummy")return d;var i,e=d.charAt(0);switch(e){case"M":c="m3u",i=d;break;case"H":c="hdhr",i=d;break;case"X":c="xmltv",i=d.substring(0,d.lastIndexOf("."));break}if(SERVER.settings.files[c].hasOwnProperty(i)==!0){var u=SERVER.settings.files[c][i];return u[t]}}function setXmltvChannel(d,c){var t=new XMLTVFile,i=c.value,e=SERVER.xepg.epgMapping[d]["tvg-id"],u=document.getElementById("popup-mapping").parentElement;u.innerHTML="";var s=t.getPrograms(c.value,e);s.setAttribute("name","x-mapping"),s.setAttribute("id","popup-mapping"),s.setAttribute("onchange","javascript: this.className = 'changed'; checkXmltvChannel('"+d+"',this,'"+i+"');"),s.className="changed",sortSelect(s),u.appendChild(s),checkXmltvChannel(d,s,i)}function checkXmltvChannel(d,c,t){var i=c.value,e,u=document.getElementById("active"),s=SERVER.xepg.epgMapping[d],o;if(i=="-"?e=!1:e=!0,u.checked=e,u.className="changed",t!="xTeVe Dummy"&&e==!0){changeChannelLogo(d);return}t=="xTeVe Dummy"&&(document.getElementById("update-icon").checked=!1,document.getElementById("update-icon").className="changed")}function changeChannelLogo(d){var c,t=SERVER.xepg.epgMapping[d],i=document.getElementById("popup-xmltv"),e=i.options[i.selectedIndex].value,u=document.getElementById("popup-mapping"),s=u.options[u.selectedIndex].value,o=SERVER.xepg.xmltvMap[e][s].icon;if(c=document.getElementById("update-icon").checked,c==!0&&e!="xTeVe Dummy"){if(SERVER.xepg.xmltvMap[e].hasOwnProperty(s))var n=o;else n=t["tvg-logo"];var p=document.getElementById("channel-icon");p.value=n,BULK_EDIT==!1&&(p.className="changed")}}function savePopupData(d,c,t,i){if(d=="mapping"){var h=new Object;l="saveEpgMapping",h.epgMapping=SERVER.xepg.epgMapping;var v=new Server(l);v.request(h),delete UNDO.epgMapping;return}var e=document.getElementById("popup-custom"),u=e.getElementsByTagName("TABLE")[0].getElementsByTagName("INPUT"),s=e.getElementsByTagName("TABLE")[0].getElementsByTagName("SELECT"),o=new Object,n;for(let m=0;m<s.length;m++){var p;p=s[m].name;var r=s[m].value;switch(p){case"tuner":o[p]=parseInt(r);break;default:o[p]=r;break}}for(let m=0;m<u.length;m++)switch(u[m].type){case"checkbox":p=u[m].name,o[p]=u[m].checked;break;case"text":case"hidden":case"password":switch(p=u[m].name,p){case"tuner":o[p]=parseInt(u[m].value);break;default:o[p]=u[m].value;break}break}var h=new Object,l;switch(t==!0&&(o.delete=!0),d){case"users":if(n="Delete this user?",c=="-")l="saveNewUser",h.userData=o;else{l="saveUserData";var b=new Object;b[c]=o,h.userData=b}break;case"m3u":switch(n="Delete this playlist?",i){case 0:l="saveFilesM3U";break;case 1:l="updateFileM3U";break}h.files=new Object,h.files[d]=new Object,h.files[d][c]=o;break;case"hdhr":switch(n="Delete this HDHomeRun tuner?",i){case 0:l="saveFilesHDHR";break;case 1:l="updateFileHDHR";break}h.files=new Object,h.files[d]=new Object,h.files[d][c]=o;break;case"xmltv":switch(n="Delete this XMLTV file?",i){case 0:l="saveFilesXMLTV";break;case 1:l="updateFileXMLTV";break}h.files=new Object,h.files[d]=new Object,h.files[d][c]=o;break;case"filter":n="Delete this filter?",l="saveFilter",h.filter=new Object,h.filter[c]=o;break;default:return}if(t==!0&&!confirm(n)){showElement("popup",!1);return}var v=new Server(l);v.request(h)}function donePopupData(d,c){var t=c.split(","),i=document.getElementById("popup-custom"),e=i.getElementsByClassName("changed");t.forEach(u=>{var s=new Object;s=SERVER.xepg.epgMapping[u];for(let p=0;p<e.length;p++){var o,n;switch(e[p].tagName){case"INPUT":switch(e[p].type){case"checkbox":o=e[p].name,n=e[p].checked,s[o]=n;break;case"text":o=e[p].name,n=e[p].value,s[o]=n;break}break;case"SELECT":o=e[p].name,n=e[p].value,s[o]=n;break}switch(o){case"tvg-logo":break;case"x-name":document.getElementById(u).childNodes[3].firstChild.innerHTML=n;break;case"x-category":document.getElementById(u).childNodes[3].firstChild.className=n;break;case"x-group-title":document.getElementById(u).childNodes[5].firstChild.innerHTML=n;break;case"x-xmltv-file":n!="xTeVe Dummy"&&n!="-"&&(n=getValueFromProviderFile(n,"xmltv","name")),n=="-"&&(s["x-active"]=!1),document.getElementById(u).childNodes[6].firstChild.innerHTML=n;break;case"x-mapping":n=="-"&&(s["x-active"]=!1),document.getElementById(u).childNodes[7].firstChild.innerHTML=n;break;default:}createSearchObj(),searchInMapping()}s["x-active"]==!1?document.getElementById(u).className="notActiveEPG":document.getElementById(u).className="activeEPG",document.getElementById(u).childNodes[2].firstChild.setAttribute("src",s["tvg-logo"])}),showElement("popup",!1)}function showPreview(d){var c=document.getElementById("myStreamsBox");switch(d){case!1:c.className="notVisible";return}var t=["activeStreams","inactiveStreams"];t.forEach(i=>{var e=document.getElementById(i);e.innerHTML="";var u=SERVER.data.StreamPreviewUI[i];u.forEach(s=>{var o=document.createElement("TR"),n=document.createElement("TD"),p=document.createElement("TD");switch(n.className="tdKey",p.className="tdVal",i){case"activeStreams":n.innerText="Channel: (+)";break;case"inactiveStreams":n.innerText="Channel: (-)";break}p.innerText=s,o.appendChild(n),o.appendChild(p),e.appendChild(o)})}),showElement("loading",!1),c.className="visible"}
